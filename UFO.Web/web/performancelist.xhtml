<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
     xmlns:h="http://xmlns.jcp.org/jsf/html"
     xmlns:c="http://xmlns.jcp.org/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:x="http://java.sun.com/jsp/jstl/core">

    <h:form>
        <p:calendar id="inline-date-picker" value="#{performanceCollectionBean.date}" mode="inline">
            <p:ajax process="inline-date-picker" event="dateSelect" partialSubmit="true" listener="#{performanceCollectionBean.dateChange}" update="performancesoverview"/>
        </p:calendar>
    </h:form>

    <p:panelGrid id="performancesoverview">

        <f:facet name="header">
            <p:row>
                <p:column colspan="13">Zeitplan</p:column>
            </p:row>
            <p:row>
                <p:column>Datum</p:column>
                <p:column>Spielst√§tten</p:column>
                <x:forEach items="#{performanceCollectionBean.hours}" var="hour">
                    <p:column>#{hour}</p:column>
                </x:forEach>
            </p:row>
        </f:facet>

        <x:forEach items="#{performanceCollectionBean.performancesOverview}" var="p">
            <p:row>
                <p:column styleClass="artist-table">#{performanceCollectionBean.toDateString(p.dateTime)}</p:column>
                <p:column styleClass="artist-table">
                    <p:link href="#{request.contextPath}/ufo/venue.xhtml?id=#{p.venue.venueId}">
                        #{p.venue.venueId}
                    </p:link>
                </p:column>

                <x:forEach items="#{performanceCollectionBean.hours}" var="hour">
                    <x:choose>
                        <x:when test="#{not empty performanceCollectionBean.checkPerformanceAvailable(p, hour)}">
                            <p:column styleClass="artist-table" style="background-color: #{p.artist.category.color}">
                                <div>
                                    <p:link styleClass="artist-link" href="#{request.contextPath}/ufo/artist.xhtml?id=#{p.artist.artistId}">
                                        #{p.artist.name} (#{p.artist.category.categoryId})
                                    </p:link>
                                </div>
                                <p:outputPanel rendered="#{sessionBean.authenticated}">
                                    <p:commandLink styleClass="artist-link-cancel" action="#{performanceCollectionBean.cancelAction(p)}" update="performancesoverview">
                                        [Stornieren]
                                    </p:commandLink>
                                </p:outputPanel>

                                <p:outputPanel rendered="#{sessionBean.authenticated}">
                                    <p:commandLink styleClass="artist-link-edit" onclick="PF('dlg2').show();">
                                        [Verschieben]
                                    </p:commandLink>
                                </p:outputPanel>
                            </p:column>
                        </x:when>
                        <x:otherwise>
                            <p:column styleClass="artist-table" />
                        </x:otherwise>
                    </x:choose>
                </x:forEach>
            </p:row>
        </x:forEach>
    </p:panelGrid>

    <p:dialog header="Modal Dialog" widgetVar="dlg2" modal="true" height="100">
        <h:outputText value="This is a Modal Dialog." />
    </p:dialog>

</div>